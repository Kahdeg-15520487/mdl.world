<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Optional: Set API base URL via meta tag -->
    <!-- <meta name="api-base-url" content="http://your-api-server:5000"> -->
    <title>Fantasy World Generator</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        :root {
            /* Light theme variables */
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --container-bg: rgba(255, 255, 255, 0.95);
            --text-color: #1a1a1a;
            --text-secondary: #4a4a4a;
            --header-gradient-start: #4c63d2;
            --header-gradient-end: #5a67d8;
            --tabs-bg: #f8f9fa;
            --tab-border: #dee2e6;
            --tab-hover: #e9ecef;
            --card-bg: white;
            --card-border: #e9ecef;
            --card-border-hover: #4c63d2;
            --input-bg: white;
            --input-border: #ced4da;
            --button-bg: #4c63d2;
            --success-bg: #d4edda;
            --error-bg: #f8d7da;
            --config-bg: #f8f9fa;
            --config-border: #e9ecef;
        }

        [data-theme="dark"] {
            /* Dark theme variables */
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --container-bg: rgba(30, 30, 46, 0.95);
            --text-color: #e0e0e0;
            --text-secondary: #a0a0a0;
            --header-gradient-start: #2d3748;
            --header-gradient-end: #1a202c;
            --tabs-bg: #2d3748;
            --tab-border: #4a5568;
            --tab-hover: #4a5568;
            --card-bg: #2d3748;
            --card-border: #4a5568;
            --card-border-hover: #667eea;
            --input-bg: #2d3748;
            --input-border: #4a5568;
            --button-bg: #667eea;
            --success-bg: #1a2e1a;
            --error-bg: #2e1a1a;
            --config-bg: #2d3748;
            --config-border: #4a5568;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--container-bg);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--header-gradient-start) 0%, var(--header-gradient-end) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 8px 16px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .theme-toggle-icon {
            font-size: 1.1rem;
        }

        .tabs {
            display: flex;
            background: var(--tabs-bg);
            border-bottom: 1px solid var(--tab-border);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-color);
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .tab.active {
            background: var(--card-bg);
            color: var(--button-bg);
            border-bottom: 3px solid var(--button-bg);
            opacity: 1;
        }

        .tab:hover {
            background: var(--tab-hover);
            opacity: 1;
        }

        .tab-content {
            padding: 30px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            background: var(--input-bg);
            color: var(--text-color);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--button-bg);
            box-shadow: 0 0 0 3px rgba(76, 99, 210, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            background: linear-gradient(135deg, var(--button-bg) 0%, #5a67d8 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 99, 210, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .world-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .world-card {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .world-card:hover {
            border-color: var(--card-border-hover);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .world-card h3 {
            color: var(--button-bg);
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .world-card p {
            color: var(--text-secondary);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .world-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--card-border);
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .world-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .world-actions .btn {
            padding: 8px 16px;
            font-size: 0.9rem;
            margin: 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e9ecef;
            border-top: 3px solid #4c63d2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #c3e6cb;
        }

        .wiki-frame {
            width: 100%;
            height: 600px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        .config-info {
            background: var(--config-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid var(--config-border);
        }

        .config-info p {
            color: var(--text-color);
        }

        .config-info ul {
            color: var(--text-secondary);
        }

        .api-url-display {
            background: var(--config-border);
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 10px 0;
            color: var(--text-color);
        }

        .config-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        .config-list {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
            padding-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
                <span class="theme-toggle-icon">üåô</span>
                <span>Dark Mode</span>
            </button>
            <h1>üåü Fantasy World Generator</h1>
            <p>Create, manage, and explore rich fantasy worlds with magic and technology</p>
            <div class="service-status">
                <div id="llm-status" class="status-indicator unavailable" title="LLM Service Status" onclick="LLMServiceStatus.showHealthModal()">
                    <span class="status-dot"></span>
                    <span class="status-text">LLM Service</span>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('generate')">Generate World</button>
            <button class="tab" onclick="showTab('manage')">My Worlds</button>
            <button class="tab" onclick="showTab('wiki')">View Wiki</button>
            <button class="tab" onclick="showTab('config')">Settings</button>
        </div>

        <div class="tab-content">
            <!-- Generate World Tab -->
            <div id="generate-tab" class="tab-panel active">
                <h2>Generate New World</h2>
                <form id="generateForm">
                    <div class="form-group">
                        <label for="worldName">World Name</label>
                        <input type="text" id="worldName" name="worldName" placeholder="Enter your world name" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="theme">Theme</label>
                            <select id="theme" name="theme" required>
                                <option value="Fantasy-SciFi">Fantasy-SciFi</option>
                                <option value="Cyberpunk-Fantasy">Cyberpunk-Fantasy</option>
                                <option value="Space-Magic">Space-Magic</option>
                                <option value="Bio-Magical">Bio-Magical</option>
                                <option value="Quantum-Mystical">Quantum-Mystical</option>
                                <option value="Steampunk-Arcane">Steampunk-Arcane</option>
                                <option value="Digital-Shamanism">Digital-Shamanism</option>
                                <option value="Techno-Druidism">Techno-Druidism</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="generationType">Generation Type</label>
                            <select id="generationType" name="generationType" onchange="toggleAdvancedOptions()">
                                <option value="basic">Basic World</option>
                                <option value="complete">Complete World</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="techLevel">Technology Level (1-10)</label>
                            <input type="range" id="techLevel" name="techLevel" min="1" max="10" value="6" oninput="updateRangeValue('techLevel')">
                            <span id="techLevelValue">6</span>
                        </div>

                        <div class="form-group">
                            <label for="magicLevel">Magic Level (1-10)</label>
                            <input type="range" id="magicLevel" name="magicLevel" min="1" max="10" value="8" oninput="updateRangeValue('magicLevel')">
                            <span id="magicLevelValue">8</span>
                        </div>
                    </div>

                    <!-- Advanced Options (shown for complete world) -->
                    <div id="advancedOptions" class="hidden">
                        <h3>Advanced Options</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="totalPlaces">Total Places</label>
                                <input type="number" id="totalPlaces" name="totalPlaces" value="50" min="10" max="200">
                            </div>

                            <div class="form-group">
                                <label for="characterCount">Character Count</label>
                                <input type="number" id="characterCount" name="characterCount" value="25" min="5" max="100">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="equipmentCount">Equipment Count</label>
                                <input type="number" id="equipmentCount" name="equipmentCount" value="40" min="10" max="150">
                            </div>

                            <div class="form-group">
                                <label for="difficultyLevel">Difficulty Level</label>
                                <select id="difficultyLevel" name="difficultyLevel">
                                    <option value="Easy">Easy</option>
                                    <option value="Medium" selected>Medium</option>
                                    <option value="Hard">Hard</option>
                                    <option value="Epic">Epic</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn" id="generateBtn">
                            üåü Generate World
                        </button>
                    </div>
                </form>

                <div id="generateResult"></div>
            </div>

            <!-- My Worlds Tab -->
            <div id="manage-tab" class="tab-panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>My Worlds</h2>
                    <button class="btn" onclick="loadWorlds()">üîÑ Refresh</button>
                </div>
                
                <!-- Search and Filter -->
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="worldSearch">Search Worlds</label>
                        <input type="text" id="worldSearch" placeholder="Search by name, theme, or description..." oninput="handleSearch()">
                    </div>
                    <div class="form-group">
                        <label for="worldFilter">Filter by Type</label>
                        <select id="worldFilter" onchange="handleSearch()">
                            <option value="all">All Worlds</option>
                            <option value="fantasy">Fantasy</option>
                            <option value="scifi">Sci-Fi</option>
                            <option value="cyberpunk">Cyberpunk</option>
                            <option value="steampunk">Steampunk</option>
                        </select>
                    </div>
                </div>
                
                <div id="worldsList"></div>
            </div>

            <!-- Wiki Tab -->
            <div id="wiki-tab" class="tab-panel">
                <h2>World Wiki Viewer</h2>
                
                <div class="form-group">
                    <label for="wikiWorldSelect">Select World</label>
                    <select id="wikiWorldSelect" onchange="loadWikiOptions()">
                        <option value="">Select a world...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="wikiType">Wiki Type</label>
                    <select id="wikiType">
                        <option value="world">Full World Wiki</option>
                        <option value="place">Specific Place</option>
                        <option value="character">Specific Character</option>
                        <option value="item">Specific Item</option>
                    </select>
                </div>

                <div class="form-group" id="specificIdGroup" style="display: none;">
                    <label for="specificId">ID</label>
                    <input type="text" id="specificId" placeholder="Enter specific ID">
                </div>

                <button class="btn" onclick="loadWiki()">üìñ Load Wiki</button>

                <iframe id="wikiFrame" class="wiki-frame hidden"></iframe>
            </div>

            <!-- Configuration Tab -->
            <div id="config-tab" class="tab-panel">
                <h2>‚öôÔ∏è Settings</h2>
                
                <div class="form-group">
                    <label>API Configuration</label>
                    <div class="config-info">
                        <p><strong>Current API Base URL:</strong></p>
                        <code id="currentApiUrl" class="api-url-display">Loading...</code>
                        <p class="config-text">
                            The API URL can be configured in several ways (in order of priority):
                        </p>
                        <ul class="config-list">
                            <li>URL parameter: <code>?api=http://your-server:5000</code></li>
                            <li>Meta tag in HTML head</li>
                            <li>Local storage (set below)</li>
                            <li>Auto-detection based on current host</li>
                            <li>Default fallback: http://localhost:5000</li>
                        </ul>
                    </div>
                    
                    <div class="form-row">
                        <button class="btn" onclick="showApiConfig()">üîß Change API URL</button>
                        <button class="btn btn-secondary" onclick="resetApiConfig()">üîÑ Reset to Auto</button>
                        <button class="btn btn-secondary" onclick="testApiConnection()">üîç Test Connection</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Quick API Presets</label>
                    <div class="form-row">
                        <button class="btn btn-secondary" onclick="setApiUrl('http://localhost:5000')">Local Development</button>
                        <button class="btn btn-secondary" onclick="setApiUrl('http://localhost:5001')">Alt Port 5001</button>
                        <button class="btn btn-secondary" onclick="setApiUrl('https://api.yourdomain.com')">Production</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>LLM Configuration</label>
                    <div class="config-info">
                        <p><strong>Current LLM Service URL:</strong></p>
                        <code id="currentLlmUrl" class="api-url-display">Loading...</code>
                        <p><strong>Current Model:</strong></p>
                        <code id="currentLlmModel" class="api-url-display">Loading...</code>
                        <p class="config-text">
                            Configure the Language Model service for text generation and world enhancement.
                        </p>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="llmBaseUrl">LLM Base URL</label>
                                <input type="text" id="llmBaseUrl" placeholder="http://localhost:8080" class="api-input">
                            </div>
                            <div class="form-group">
                                <label for="llmModel">Model Name</label>
                                <input type="text" id="llmModel" placeholder="local-model" class="api-input">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <button class="btn" onclick="updateLlmConfig()">üîß Update LLM Config</button>
                        <button class="btn btn-secondary" onclick="testLlmConnection()">üîç Test LLM Connection</button>
                        <button class="btn btn-secondary" onclick="loadLlmConfig()">üîÑ Reload Config</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>LLM Quick Presets</label>
                    <div class="form-row">
                        <button class="btn btn-secondary" onclick="setLlmConfig('http://localhost:8080', 'local-model')">üè† Local LLM</button>
                        <button class="btn btn-secondary" onclick="setLlmConfig('http://localhost:11434', 'llama2')">ü¶ô Ollama Default</button>
                        <button class="btn btn-secondary" onclick="setLlmConfig('http://localhost:1234', 'lm-studio')">üé¨ LM Studio</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Application Info</label>
                    <div class="config-info">
                        <p><strong>Fantasy World Generator</strong></p>
                        <p>Create, manage, and explore rich fantasy worlds with magic and technology</p>
                        <p class="config-text">
                            <strong>Features:</strong> Dynamic API configuration, Local storage, Auto-detection
                        </p>
                    </div>
                </div>

                <div id="configResult"></div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
